import{j as s}from"./jsx-runtime-u17CrQMm.js";import{R as u}from"./iframe-CUpoYAUB.js";import{c as y}from"./client-Cr3D5Hxb.js";import{r as C}from"./index-AMS0wgWQ.js";import{I as w,W as j}from"./Info-BcfQhsHo.js";import{C as R}from"./Close-IiX-HAFp.js";import{C as _}from"./Check-C9Lcua7d.js";const p=r=>s.jsxs("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",...r,children:[s.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",strokeOpacity:"0.2",fill:"none"}),s.jsx("path",{d:"M22 12a10 10 0 0 0-10-10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",fill:"none",children:s.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 12 12",to:"360 12 12",dur:"0.9s",repeatCount:"indefinite"})})]});p.__docgenInfo={description:"",methods:[],displayName:"Spinner"};const m=u.forwardRef((r,e)=>{const{items:t,onRemove:o,host:c,disablePortal:n}=r;if(typeof document>"u")return null;const d=s.jsx("div",{ref:e,className:`beaver-toast-container${n?" beaver-toast-container--inline":""}`,...n?{"data-inline":"true"}:{},children:t.map(a=>s.jsx(P,{item:a,onRemove:()=>o(a.id)},a.id))});return n?d:C.createPortal(d,c??document.body)});m.displayName="ToastContainer";const P=({item:r,onRemove:e})=>{const{type:t="info",title:o,message:c,duration:n=3e3,onClose:d,icon:a,closable:g=!0}=r;u.useEffect(()=>{if(n>0){const x=setTimeout(()=>{v()},n);return()=>clearTimeout(x)}},[n]);const v=()=>{e(),d?.()},f=["beaver-toast"];t&&f.push(`beaver-toast--${t}`),o&&f.push("beaver-toast--has-title");const b=a!==void 0?a:{success:s.jsx(_,{width:18,height:18,"aria-hidden":!0}),warning:s.jsx(j,{width:18,height:18,"aria-hidden":!0}),error:s.jsx(R,{width:18,height:18,"aria-hidden":!0}),info:s.jsx(w,{width:18,height:18,"aria-hidden":!0}),loading:s.jsx(p,{width:18,height:18,"aria-hidden":!0})}[t];return s.jsxs("div",{className:f.join(" "),role:"alert",children:[s.jsx("div",{className:`beaver-toast__icon beaver-toast__icon--${t}`,children:b}),s.jsxs("div",{className:"beaver-toast__content",children:[o&&s.jsx("div",{className:"beaver-toast__title",children:o}),c&&s.jsx("div",{className:"beaver-toast__message",children:c})]}),g&&s.jsx("button",{type:"button",className:"beaver-toast__close","aria-label":"关闭通知",onClick:v,children:"×"})]})};class T{constructor(){this.items=[],this.listeners=new Set,this.idCounter=0,this.providerCount=0,this.providerListeners=new Set,this.generation=0}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}subscribeProviderChange(e){return this.providerListeners.add(e),()=>this.providerListeners.delete(e)}registerProvider(){this.providerCount+=1,this.providerListeners.forEach(e=>e(this.providerCount>0)),this.generation+=1,this.items=[],this.notify()}unregisterProvider(){this.providerCount=Math.max(0,this.providerCount-1),this.providerListeners.forEach(e=>e(this.providerCount>0)),this.providerCount===0&&(this.generation+=1,this.items=[],this.notify())}hasProvider(){return this.providerCount>0}notify(){const e=this.generation,t=this.items.filter(o=>o.generation===e);this.listeners.forEach(o=>o([...t]))}generateId(){return`toast-${++this.idCounter}-${Date.now()}`}getItems(){return[...this.items]}getGeneration(){return this.generation}add(e){I();const t=this.generateId(),o={...e,id:t,generation:this.generation};return this.items.push(o),this.notify(),t}remove(e){this.items=this.items.filter(t=>t.id!==e),this.notify()}clear(){this.items=[],this.notify()}success(e,t){return this.add({...t,type:"success",message:e})}warning(e,t){return this.add({...t,type:"warning",message:e})}error(e,t){return this.add({...t,type:"error",message:e})}info(e,t){return this.add({...t,type:"info",message:e})}loading(e,t){return this.add({...t,type:"loading",message:e,duration:0})}show(e){return this.add(e)}}const i=new T;let h=null,l=null;function I(){if(typeof window>"u"||i.hasProvider()||h)return;const r=document.getElementById("beaver-toast-root"),e=r??document.createElement("div");r||(e.id="beaver-toast-root",document.body.appendChild(e)),l=e,h=y.createRoot(e);const t=n=>{h.render(s.jsx(m,{items:n,onRemove:d=>i.remove(d)}))};try{const n=i.getGeneration(),d=i.getItems().filter(a=>a.generation===n);t(d)}catch{t([])}const o=i.subscribe(n=>t(n)),c=i.subscribeProviderChange(n=>{n&&(o(),c(),Promise.resolve().then(()=>N()))})}function N(){if(h){try{h.unmount()}catch{}h=null}l&&l.parentElement&&(l.parentElement.removeChild(l),l=null)}const E=({children:r,limitToProvider:e=!1})=>{const t=u.useRef(null),o=u.useRef(null),[c,n]=u.useState([]);u.useLayoutEffect(()=>{i.registerProvider(),i.clear();const a=i.subscribe(n);return()=>{a(),i.unregisterProvider()}},[]);const d=a=>{i.remove(a)};return s.jsxs(s.Fragment,{children:[r,e?s.jsx("div",{ref:o,className:"beaver-toast-provider-host",children:s.jsx(m,{ref:t,disablePortal:!0,items:c,onRemove:d})}):s.jsx(m,{ref:t,items:c,onRemove:d})]})},B={success:(r,e)=>i.success(r,e),warning:(r,e)=>i.warning(r,e),error:(r,e)=>i.error(r,e),info:(r,e)=>i.info(r,e),loading:(r,e)=>i.loading(r,e),show:r=>i.show(r),close:r=>i.remove(r),clear:()=>i.clear()};E.__docgenInfo={description:`Toast 提供器组件

需要在应用的根部包裹此组件，以便全局调用 Toast`,methods:[],displayName:"ToastProvider",props:{children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},limitToProvider:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}}}};export{E as T,B as a};
