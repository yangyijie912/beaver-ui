import{j as N}from"./jsx-runtime-u17CrQMm.js";import{R as $,r}from"./iframe-B140BTaK.js";const D=r.createContext(void 0),U=()=>{const m=r.useContext(D);if(!m)throw new Error("useFormContext 必须在 Form 内部使用");return m},A=$.forwardRef(({className:m,initialValues:h={},onSubmit:P,beforeSubmit:x,layout:g="vertical",labelWidth:f,disabled:q=!1,size:w="medium",children:B,...I},C)=>{const[n,c]=r.useState(h),[K,k]=r.useState({}),[l,S]=r.useState(new Map),[z,F]=r.useState(!1),j=r.useCallback((e,a)=>{c(t=>({...t,[e]:a}))},[]),i=r.useCallback((e,a)=>{k(t=>({...t,[e]:a}))},[]),R=r.useCallback(e=>{const a=l.get(e);return a?a.rules:[]},[l]),V=r.useCallback(async e=>{const a=l.get(e),t=a?a.rules:[],p=n[e];if(t.length===0)return i(e,void 0),!0;const u=!!a?.disabled;if(u&&t.filter(o=>o.validateWhenDisabled).length===0)return i(e,void 0),!0;const b=u?t.filter(s=>s.validateWhenDisabled):t;for(const s of b){const o=s.validate(p,n),y=o instanceof Promise?await o:o;if(y)return i(e,y),!1}return i(e,void 0),!0},[n,R,i,l]),T=r.useCallback(async()=>{const e=Array.from(l.keys());return(await Promise.all(e.map(t=>V(t)))).every(t=>t)},[l,V]),O=async e=>{if(e.preventDefault(),F(!0),!!await T()){if(x)try{if(await x(n)===!1)return}catch(t){console.error("beforeSubmit 处理失败:",t);return}if(P)try{if(await P(n)===!1)return}catch(t){console.error("表单提交失败:",t)}}},_=r.useCallback((e,a,t)=>{S(p=>{const u=p.get(e),b=!!t?.disabled,s=L=>(L||[]).map(v=>{try{return typeof v.validate=="function"?v.validate.toString():JSON.stringify(v)}catch{return String(v)}}).join("|"),o=u?s(u.rules)+`::${!!u.disabled}`:null,y=s(a)+`::${b}`;if(o===y)return p;const M=new Map(p);return M.set(e,{rules:a,disabled:b}),M})},[]),H=r.useCallback(e=>{S(a=>{const t=new Map(a);return t.delete(e),t})},[]),E={getValues:()=>n,setValues:e=>{c(a=>({...a,...e}))},setFieldValue:(e,a)=>{j(e,a)},setFieldsValue:e=>{c(a=>({...a,...e}))},validate:T,reset:()=>{c(h),k({}),F(!1)},clear:()=>{const e={};Object.keys(n).forEach(a=>{e[a]=""}),c(e),k({}),F(!1)}};$.useImperativeHandle(C,()=>E);const d=["beaver-form"];g&&d.push(`beaver-form--${g}`),q&&d.push("beaver-form--disabled"),w&&d.push(`beaver-form--${w}`),m&&d.push(m);const J={...f!==void 0?{"--beaver-form-label-width":typeof f=="number"?`${f}px`:f}:{}};return N.jsx(D.Provider,{value:{...E,values:n,errors:K,submitAttempted:z,setFieldValue:j,validateField:V,setFieldError:i,getFieldRules:R,disabled:q,size:w,registerField:_,unregisterField:H,layout:g},children:N.jsx("form",{ref:C,className:d.join(" "),style:J,onSubmit:O,noValidate:!0,...I,children:B})})});A.displayName="Form";A.__docgenInfo={description:"",methods:[{name:"getValues",docblock:"获取表单的所有字段值",modifiers:[],params:[],returns:null,description:"获取表单的所有字段值"},{name:"setValues",docblock:"设置表单的字段值",modifiers:[],params:[{name:"newValues",optional:!1,type:{name:"signature",type:"object",raw:`{
  [key: string]: any;
}`,signature:{properties:[{key:{name:"string"},value:{name:"any",required:!0}}]},alias:"FieldValue"}}],returns:null,description:"设置表单的字段值"},{name:"setFieldValue",docblock:"设置单个字段的值",modifiers:[],params:[{name:"name",optional:!1,type:{name:"string"}},{name:"value",optional:!1,type:{name:"any"}}],returns:null,description:"设置单个字段的值"},{name:"setFieldsValue",docblock:"批量设置字段值",modifiers:[],params:[{name:"newValues",optional:!1,type:{name:"signature",type:"object",raw:`{
  [key: string]: any;
}`,signature:{properties:[{key:{name:"string"},value:{name:"any",required:!0}}]},alias:"FieldValue"}}],returns:null,description:"批量设置字段值"},{name:"reset",docblock:"重置表单为初始值",modifiers:[],params:[],returns:null,description:"重置表单为初始值"},{name:"clear",docblock:"清空表单",modifiers:[],params:[],returns:null,description:"清空表单"}],displayName:"Form",props:{initialValues:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  [key: string]: any;
}`,signature:{properties:[{key:{name:"string"},value:{name:"any",required:!0}}]}},description:"初始表单数据",defaultValue:{value:"{}",computed:!1}},beforeSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(values: FieldValue) => boolean | Promise<boolean>",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  [key: string]: any;
}`,signature:{properties:[{key:{name:"string"},value:{name:"any",required:!0}}]}},name:"values"}],return:{name:"union",raw:"boolean | Promise<boolean>",elements:[{name:"boolean"},{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}]}}},description:"提交前的拦截函数，返回 `false` 则阻止提交。支持同步或异步（返回 Promise<boolean>）。\n若未提供，可在 `onSubmit` 中返回 `false` 作为兼容行为，但推荐使用 `beforeSubmit`。"},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(values: FieldValue) => void | Promise<void> | boolean | Promise<boolean>",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
  [key: string]: any;
}`,signature:{properties:[{key:{name:"string"},value:{name:"any",required:!0}}]}},name:"values"}],return:{name:"union",raw:"void | Promise<void> | boolean | Promise<boolean>",elements:[{name:"void"},{name:"Promise",elements:[{name:"void"}],raw:"Promise<void>"},{name:"boolean"},{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}]}}},description:"提交时的回调函数。若回调返回 `false`（或 Promise<false>），则视为取消提交。"},layout:{required:!1,tsType:{name:"union",raw:"'vertical' | 'horizontal' | 'inline'",elements:[{name:"literal",value:"'vertical'"},{name:"literal",value:"'horizontal'"},{name:"literal",value:"'inline'"}]},description:"表单布局方式",defaultValue:{value:"'vertical'",computed:!1}},labelWidth:{required:!1,tsType:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}]},description:"标签宽度（仅在 horizontal 布局时生效），例如 '100px' 或 120"},disabled:{required:!1,tsType:{name:"boolean"},description:"表单全局禁用",defaultValue:{value:"false",computed:!1}},size:{required:!1,tsType:{name:"union",raw:"'small' | 'medium' | 'large'",elements:[{name:"literal",value:"'small'"},{name:"literal",value:"'medium'"},{name:"literal",value:"'large'"}]},description:"表单尺寸",defaultValue:{value:"'medium'",computed:!1}},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"子元素"}}};export{D as F,A as a,U as u};
